<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√©pins de tüçÖmates | Smash</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* REPRISE DES VARIABLES ET STYLES DE INDEX.HTML */
        :root {
            --primary: #d63031;
            --primary-dark: #b32626;
            --bg: #fdfdfc;
            --card: #ffffff;
            --text: #2d3436;
            --text-light: #636e72;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        body.dark-mode {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #e0e0e0;
            --text-light: #a0a0a0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Feeling App */
        }

        /* HEADER AVEC TES BOUTONS */
        .header-nav {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .btn-ui {
            background: var(--card);
            border: none;
            padding: 12px;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--text);
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .btn-ui:hover { transform: scale(1.1); }

        /* ZONE SMASH */
        .smash-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }

        /* FL√àCHES MODERNES SANS CONTOURS */
        .nav-arrow {
            background: none;
            border: none;
            font-size: 3rem;
            color: var(--text);
            cursor: pointer;
            padding: 20px;
            opacity: 0.3;
            transition: 0.3s;
            z-index: 10;
        }
        .nav-arrow:hover { opacity: 1; transform: scale(1.2); }

        /* CARTE STYLE INDEX.HTML */
        .card-container {
            width: 100%;
            max-width: 380px;
            height: 550px;
            position: relative;
            perspective: 1000px;
        }

        .tomato-card {
            width: 100%;
            height: 100%;
            background: var(--card);
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.4s;
        }

        .img-container {
            width: 100%;
            height: 60%;
            position: relative;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info {
            padding: 25px;
            text-align: center;
        }

        .info h2 { font-weight: 800; margin: 0 0 10px 0; font-size: 1.6rem; }
        .info p { color: var(--text-light); font-size: 0.95rem; line-height: 1.4; }

        /* BOUTONS ACTIONS (REPRISE STYLE INDEX.HTML) */
        .actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            padding-bottom: 40px;
        }

        .btn-action {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .btn-pass { background: #eb4d4b; } /* Rouge Tomate */
        .btn-keep { background: #6ab04c; } /* Vert Feuille */
        
        .btn-action:hover { transform: translateY(-5px) scale(1.1); box-shadow: 0 15px 25px rgba(0,0,0,0.2); }

        /* ANIMATIONS SWIPE */
        .swipe-right { transform: translateX(200%) rotate(30deg) !important; opacity: 0; }
        .swipe-left { transform: translateX(-200%) rotate(-30deg) !important; opacity: 0; }
    </style>
</head>
<body>

    <div class="header-nav">
        <a href="menu.html" class="btn-ui">üè†</a>
        <div style="display: flex; gap: 10px;">
            <a href="user.html" class="btn-ui">üë§</a>
            <a href="set.html" class="btn-ui">‚öôÔ∏è</a>
            <a href="index.html" class="btn-ui">üõí <span id="cart-count">0</span></a>
        </div>
    </div>

    <div class="smash-area">
        <button class="nav-arrow" onclick="changeTomato(-1)">&lt;</button>
        
        <div class="card-container" id="cardStack">
            </div>

        <button class="nav-arrow" onclick="changeTomato(1)">&gt;</button>
    </div>

    <div class="actions">
        <button class="btn-action btn-pass" onclick="handleSwipe('left')">‚úñ</button>
        <button class="btn-action btn-keep" onclick="handleSwipe('right')">‚úî</button>
    </div>

    <script type="module">
        import { DATA } from './data.js';

        let currentIndex = Math.floor(Math.random() * DATA.length);
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let history = [currentIndex];

        function init() {
            if(localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
            updateCartCount();
            renderCard();
        }

        function renderCard() {
            const container = document.getElementById('cardStack');
            const item = DATA[currentIndex];
            
            container.innerHTML = `
                <div class="tomato-card" id="activeCard">
                    <div class="img-container">
                        <img src="${item.images[0]}" alt="${item.nom}">
                    </div>
                    <div class="info">
                        <h2>${item.nom}</h2>
                        <p>${item.descriptionCourte}</p>
                        <div style="margin-top:10px; font-weight:600; color:var(--primary)">${item.origine}</div>
                    </div>
                </div>
            `;
        }

        window.handleSwipe = function(direction) {
            const card = document.getElementById('activeCard');
            if(direction === 'right') {
                card.classList.add('swipe-right');
                addToCart(DATA[currentIndex].id);
            } else {
                card.classList.add('swipe-left');
            }

            setTimeout(() => {
                nextRandom();
            }, 400);
        };

        function addToCart(id) {
            if(!cart.includes(id)) {
                cart.push(id);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
            }
        }

        function updateCartCount() {
            document.getElementById('cart-count').innerText = cart.length;
        }

        function nextRandom() {
            let next;
            do {
                next = Math.floor(Math.random() * DATA.length);
            } while (history.includes(next) && history.length < DATA.length);
            
            currentIndex = next;
            history.push(currentIndex);
            renderCard();
        }

        window.changeTomato = function(step) {
            currentIndex = (currentIndex + step + DATA.length) % DATA.length;
            renderCard();
        };

        init();
    </script>
</body>
</html>
